{"version":3,"sources":["../../../../server/modules/society/models/societyModel.js"],"names":["database","require","cors","jwt","process","env","SECRET_KEY","SocietyModel","getOwner","req","searchData","Promise","resolve","reject","appData","connection","getConnection","err","query","rows","console","log","error","updateFlat","updateValue","registerOwner","today","Date","flatData","body","societyId","buildingName","flatNumber","ownerSearchData","phoneNumber","email","ownerInsertData","ownerName","isAdmin","age","gender","password","then","response","JSON","stringify","dbResponse","ownerid","catch","getDetails","params","tableName","getDetailsUsingQueryParam","columnName","value","updatePendingPaymentOfFlat","pendingPayment","flatid","updatePaymentHistory","currentDate","toISOString","replace","registerBuilding","societyid","registerSociety","societyName","address","pincode"],"mappings":"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","file":"societyModel.js","sourcesContent":["var database = require('./../../../../database/database');\r\nvar cors = require('cors');\r\nvar jwt = require('jsonwebtoken');\r\nprocess.env.SECRET_KEY = 'varunv';\r\n\r\nclass SocietyModel {\r\n\r\n    getOwner = (req, searchData) => new Promise((resolve, reject)=>{\r\n        var appData = {\r\n            'error': 1,\r\n            'data': '',\r\n            'satusCode':'',\r\n            'dbResponse':''\r\n        };\r\n        database.connection.getConnection((err, connection)=> {\r\n            connection.query('select ownerid from owner where phonenumber = ? and email = ? ', searchData ,function(err, rows) {\r\n                //console.log(temp.sql);\r\n                if (!err) {\r\n                    console.log('select owner query working fine '+rows);\r\n                    appData.error = 0;\r\n                    appData['data'] = 'User registered successfully!';\r\n                    appData['dbResponse'] = rows;\r\n                    appData['satusCode'] = 201;\r\n                    resolve(appData);\r\n                    //res.status(201).json(appData);\r\n                } else {\r\n                    console.log('got error '+err);\r\n                    appData['data'] = 'Error Occured!';\r\n                    appData['satusCode'] = 400;\r\n                    appData.error = err;\r\n                    reject(appData);\r\n                    //res.status(400).json(err);\r\n                }\r\n            });\r\n        });\r\n        \r\n    })\r\n\r\n    updateFlat = (req, searchData, updateValue) => new Promise((resolve, reject)=>{\r\n        var appData = {\r\n            'error': 1,\r\n            'data': '',\r\n            'satusCode':'',\r\n            'dbResponse':''\r\n        };\r\n        console.log('searchData is ',searchData);\r\n        console.log('update value is ', updateValue);\r\n        try {\r\n\r\n            database.connection.getConnection((err, connection)=> {\r\n                connection.query(`update flat set ownerid = ${updateValue} where \r\n        societyid = ${searchData[0]} and buildingname = '${searchData[1]}' and \r\n        flatname = '${searchData[2]}'` ,function(err, rows) {\r\n            //console.log(temp.sql);\r\n            if (!err) {\r\n                console.log('select owner query working fine '+rows);\r\n                appData.error = 0;\r\n                appData['data'] = 'User registered successfully!';\r\n                appData['dbResponse'] = rows;\r\n                appData['satusCode'] = 201;\r\n                resolve(appData);\r\n                //res.status(201).json(appData);\r\n            } else {\r\n                console.log('got error '+err);\r\n                console.log(`query is ------------ update flat set ownerid = ${updateValue} where \r\n                societyid = ${searchData[0]} and buildingname = ${searchData[1]} and \r\n                flatname = ${searchData[2]}`);\r\n                appData['data'] = 'Error Occured!';\r\n                appData['satusCode'] = 400;\r\n                appData.error = err;\r\n                reject(appData);\r\n                //res.status(400).json(err);\r\n            }\r\n        });\r\n            });\r\n        \r\n        } catch(error){\r\n            console.log('got error------',error);\r\n            reject(error);\r\n\r\n        }\r\n    })\r\n\r\n\r\n    registerOwner = (req) => new Promise((resolve, reject)=>{\r\n        var today = new Date();\r\n        var appData = {\r\n            'error': 1,\r\n            'data': '',\r\n            'satusCode':'',\r\n            'dbResponse':''\r\n        };\r\n        var flatData = [req.body.societyId,req.body.buildingName, req.body.flatNumber];\r\n        var ownerSearchData = [req.body.phoneNumber, req.body.email];\r\n        var ownerInsertData =[req.body.ownerName, req.body.isAdmin, req.body.phoneNumber, \r\n            req.body.email, req.body.age, req.body.gender, req.body.password\r\n            ];\r\n            database.connection.getConnection((err, connection) => {\r\n                connection.query('insert into owner(ownername,isadmin,phonenumber,email, age, gender, password) values (?,?,?,?,?,?,?)', ownerInsertData, (err, rows) => {\r\n                    //console.log(temp.sql);\r\n                    if (!err) {\r\n        \r\n                        this.getOwner(null, ownerSearchData).then((response)=>{\r\n                            console.log('select owner query is working fine '+JSON.stringify(response));\r\n                            console.log('dbResponse.rows is ',JSON.stringify(response.dbResponse.rows));\r\n                            console.log('dbResponse.rows[0] is ',JSON.stringify(response.dbResponse));\r\n                            console.log('dbResponse.rows[0].ownerid is ',JSON.stringify(response.dbResponse[0].ownerid));\r\n        \r\n                            appData.error = 0;\r\n                            //appData[\"data\"] = \"Owner id is \"+dbResponse.rows[0].ownerid;\r\n                            appData['ownerid'] = response.dbResponse[0].ownerid;\r\n                            appData['satusCode'] = 201;\r\n                            //resolve(appData);\r\n                            return appData;\r\n                           // res.status(dbResponse.satusCode).json(dbResponse);\r\n                        }).then((appData)=>{\r\n                            resolve(this.updateFlat(null, flatData, appData.ownerid));\r\n                        }).catch((err)=>{\r\n                            console.log('got error '+err);\r\n                            appData['data'] = 'Error Occured!';\r\n                            appData['satusCode'] = 400;\r\n                            appData.error = err;\r\n                            reject(appData);\r\n                           // res.status(err.satusCode).json(err);\r\n                        });\r\n                        //res.status(201).json(appData);\r\n                    } else {\r\n                        console.log('got error '+err);\r\n                        appData['data'] = 'Error Occured!';\r\n                        appData['satusCode'] = 400;\r\n                        appData.error = err;\r\n                        reject(appData);\r\n                        //res.status(400).json(err);\r\n                    }\r\n                });\r\n            });\r\n        \r\n    })\r\n\r\n    getDetails = (req) => new Promise((resolve, reject)=>{\r\n        var appData = {\r\n            'error': 1,\r\n            'data': '',\r\n            'satusCode':'',\r\n            'dbResponse':''\r\n        };\r\n\r\n        console.log('req.params.tableName', req.params.tableName);\r\n        database.connection.getConnection((err, connection) => {\r\n            connection.query(`select * from ${req.params.tableName}` ,function(err, rows) {\r\n                //console.log(temp.sql);\r\n                if (!err) {\r\n                    console.log('select query working fine '+rows);\r\n                    appData.error = 0;\r\n                    appData['dbResponse'] = rows;\r\n                    appData['satusCode'] = 201;\r\n                    resolve(appData);\r\n                    //res.status(201).json(appData);\r\n                } else {\r\n                    console.log('got error '+err);\r\n                    appData['satusCode'] = 400;\r\n                    appData.error = err;\r\n                    reject(appData);\r\n                    //res.status(400).json(err);\r\n                }\r\n            });\r\n        });\r\n        \r\n    })\r\n\r\n    getDetailsUsingQueryParam = (req) => new Promise((resolve, reject)=>{\r\n        var appData = {\r\n            'error': 1,\r\n            'data': '',\r\n            'satusCode':'',\r\n            'dbResponse':''\r\n        };\r\n\r\n        console.log('req.params.tableName', req.params.tableName);\r\n        database.connection.getConnection((err, connection)=> {\r\n            connection.query(`select * from ${req.params.tableName} where ${req.params.columnName} = ${req.query.value}` ,function(err, rows) {\r\n                //console.log(temp.sql);\r\n                if (!err) {\r\n                    console.log('select query working fine '+rows);\r\n                    appData.error = 0;\r\n                    appData['dbResponse'] = rows;\r\n                    appData['satusCode'] = 201;\r\n                    resolve(appData);\r\n                    //res.status(201).json(appData);\r\n                } else {\r\n                    console.log('got error '+err);\r\n                    appData['satusCode'] = 400;\r\n                    appData.error = err;\r\n                    reject(appData);\r\n                    //res.status(400).json(err);\r\n                }\r\n            });\r\n        });\r\n        \r\n    })\r\n\r\n    updatePendingPaymentOfFlat = (req) => new Promise((resolve, reject)=>{\r\n        var appData = {\r\n            'error': 1,\r\n            'data': '',\r\n            'satusCode':'',\r\n            'dbResponse':''\r\n        };\r\n\r\n        console.log('req.params.tableName', req.params.tableName);\r\n        database.connection.getConnection((err, connection) =>{\r\n            connection.query(`update flat set pendingpayment = '${req.body.pendingPayment}' where ownerid =${req.body.ownerid} and flatId =${req.body.flatid}` ,function(err, rows) {\r\n                //console.log(temp.sql);\r\n                if (!err) {\r\n                    \r\n                        console.log('pending payment successfully updated '+rows);\r\n                        appData.error = 0;\r\n                        appData['dbResponse'] = rows;\r\n                        appData['satusCode'] = 201;\r\n                        resolve(appData);\r\n                    \r\n\r\n                    //res.status(201).json(appData);\r\n                } else {\r\n                    console.log('got error '+err);\r\n                    appData['satusCode'] = 400;\r\n                    appData.error = err;\r\n                    reject(appData);\r\n                    //res.status(400).json(err);\r\n                }\r\n            });\r\n        });\r\n        \r\n    })\r\n\r\n    updatePaymentHistory = (req) => new Promise((resolve, reject)=>{\r\n        var appData = {\r\n            'error': 1,\r\n            'data': '',\r\n            'satusCode':'',\r\n            'dbResponse':''\r\n        };\r\n        const currentDate = new Date();\r\n        database.connection.getConnection((err, connection) => {\r\n            connection.query(`insert into paymenthistory(flatid,paid,createddate,updateddate,ownerid) values (${req.body.flatid},${req.body.pendingPayment},'${currentDate.toISOString().replace(/([^T]+)T([^\\.]+).*/g, '$1 $2') }','${currentDate.toISOString().replace(/([^T]+)T([^\\.]+).*/g, '$1 $2') }',${req.body.ownerid});`,function(err, rows) {\r\n                //console.log(temp.sql);\r\n                if (!err) {\r\n                    console.log('pending payment history successfully updated '+rows);\r\n                    appData.error = 0;\r\n                    appData['dbResponse'] = rows;\r\n                    appData['satusCode'] = 201;\r\n                    resolve(appData);\r\n                    //res.status(201).json(appData);\r\n                } else {\r\n                    console.log('got error '+err);\r\n                    appData['satusCode'] = 400;\r\n                    appData.error = err;\r\n                    reject(appData);\r\n                    //res.status(400).json(err);\r\n                }\r\n            });\r\n        });\r\n        \r\n    })\r\n    registerBuilding = (req) => new Promise((resolve, reject)=>{\r\n        var appData = {\r\n            'error': 1,\r\n            'data': '',\r\n            'satusCode':'',\r\n            'dbResponse':''\r\n        };\r\n        const currentDate = new Date();\r\n        database.connection.getConnection((err, connection)=> {\r\n            connection.query(`insert into building(buildingname, societyid) values\r\n         ('${req.body.buildingName}',${req.body.societyid});`,function(err, rows) {\r\n            //console.log(temp.sql);\r\n            if (!err) {\r\n                console.log('pending payment history successfully updated '+rows);\r\n                appData.error = 0;\r\n                appData['dbResponse'] = rows;\r\n                appData['satusCode'] = 201;\r\n                resolve(appData);\r\n                //res.status(201).json(appData);\r\n            } else {\r\n                console.log('got error '+err);\r\n                appData['satusCode'] = 400;\r\n                appData.error = err;\r\n                reject(appData);\r\n                //res.status(400).json(err);\r\n            }\r\n        });\r\n        });\r\n        \r\n    })\r\n\r\n    registerSociety = (req) => new Promise((resolve, reject)=>{\r\n        var appData = {\r\n            'error': 1,\r\n            'data': '',\r\n            'satusCode':'',\r\n            'dbResponse':''\r\n        };\r\n        const currentDate = new Date();\r\n        database.connection.getConnection((err, connection) =>{\r\n            connection.query(`insert into society(societyName, address, pincode) values ('${req.body.societyName}', '${req.body.address}', '${req.body.pincode}');`,function(err, rows) {\r\n                //console.log(temp.sql);\r\n                if (!err) {\r\n                    console.log('Society is successfully Inserted'+rows);\r\n                    appData.error = 0;\r\n                    appData['dbResponse'] = rows;\r\n                    appData['satusCode'] = 201;\r\n                    resolve(appData);\r\n                    //res.status(201).json(appData);\r\n                } else {\r\n                    console.log('got error '+err);\r\n                    appData['satusCode'] = 400;\r\n                    appData.error = err;\r\n                    reject(appData);\r\n                    //res.status(400).json(err);\r\n                }\r\n            });\r\n        });\r\n        \r\n    })\r\n}\r\n\r\nexport default SocietyModel;"]}