{"version":3,"sources":["../../../../server/modules/society/models/societyModel.js"],"names":["database","require","cors","jwt","process","env","SECRET_KEY","SocietyModel","getOwner","req","searchData","Promise","resolve","reject","connection","query","err","rows","console","log","appData","error","registerOwner","today","Date","flatData","body","societyId","buildingName","flatNumber","ownerSearchData","phoneNumber","email","ownerInsertData","ownerName","isAdmin","age","gender","then","dbResponse","catch"],"mappings":"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","file":"societyModel.js","sourcesContent":["var database = require('./../../../../database/database');\r\nvar cors = require('cors')\r\nvar jwt = require('jsonwebtoken');\r\nprocess.env.SECRET_KEY = \"varunv\";\r\n\r\nclass SocietyModel {\r\n\r\n    getOwner = (req, searchData) => new Promise((resolve, reject)=>{\r\n        database.connection.query(\"select ownerid from owner where phonenumber = $1, email = $2 \", searchData ,function(err, rows) {\r\n            if (!err) {\r\n                console.log(\"select owner query working fine \"+rows);\r\n                appData.error = 0;\r\n                appData[\"data\"] = \"User registered successfully!\";\r\n                appData[\"dbResponse\"] = rows;\r\n                appData[\"satusCode\"] = 201;\r\n                resolve(appData);\r\n                //res.status(201).json(appData);\r\n            } else {\r\n                console.log(\"got error \"+err)\r\n                appData[\"data\"] = \"Error Occured!\";\r\n                appData[\"satusCode\"] = 400;\r\n                appData.error = err;\r\n                reject(appData);\r\n                //res.status(400).json(err);\r\n            }\r\n        });\r\n    })\r\n\r\n\r\n    registerOwner = (req) => new Promise((resolve, reject)=>{\r\n        var today = new Date();\r\n        var appData = {\r\n            \"error\": 1,\r\n            \"data\": \"\",\r\n            \"satusCode\":\"\",\r\n            \"dbResponse\":\"\"\r\n        };\r\n        var flatData = [req.body.societyId,req.body.buildingName, req.body.flatNumber];\r\n        var ownerSearchData = [req.body.phoneNumber, req.body.email]\r\n        var ownerInsertData =[req.body.ownerName, req.body.isAdmin, req.body.phoneNumber, \r\n            req.body.email, req.body.age, req.body.gender, \r\n            ]\r\n        database.connection.query('insert into owner(ownername,isadmin,phonenumber,email, age, gender) values ($1, $2, $3, $4, $5, $6)', ownerInsertData, (err, rows) => {\r\n            if (!err) {\r\n\r\n                this.getOwner(null, ownerSearchData).then((dbResponse)=>{\r\n                    console.log(\"select query is working fine \"+dbResponse);\r\n                    appData.error = 0;\r\n                    appData[\"data\"] = \"User registered successfully!\";\r\n                    appData[\"dbResponse\"] = dbResponse;\r\n                    appData[\"satusCode\"] = 201;\r\n                    resolve(appData);\r\n                   // res.status(dbResponse.satusCode).json(dbResponse);\r\n                }).catch((err)=>{\r\n                    console.log(\"got error \"+err)\r\n                    appData[\"data\"] = \"Error Occured!\";\r\n                    appData[\"satusCode\"] = 400;\r\n                    appData.error = err;\r\n                    reject(appData);\r\n                   // res.status(err.satusCode).json(err);\r\n                })\r\n                //res.status(201).json(appData);\r\n            } else {\r\n                console.log(\"got error \"+err)\r\n                appData[\"data\"] = \"Error Occured!\";\r\n                appData[\"satusCode\"] = 400;\r\n                appData.error = err;\r\n                reject(appData);\r\n                //res.status(400).json(err);\r\n            }\r\n        });\r\n    })\r\n}\r\n\r\nexport default SocietyModel;"]}